#!/usr/bin/env python3


from py_trans import PyTranslator
from langdetect import detect, detect_langs
import subprocess
import gpt_basic


def detect_lang(text):
    """ Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ None ÐµÑÐ»Ð¸ Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ, 2 Ð±ÑƒÐºÐ²ÐµÐ½Ð½Ð¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÑÐ·Ñ‹ÐºÐ° ÐµÑÐ»Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¾ÑÑŒ 'en', 'ru' Ð¸Ñ‚Ð¿ """
    # Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ»Ð¾Ð² Ð´Ð»Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ ÑÐ·Ñ‹ÐºÐ° = 8. Ð½Ð° ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ñ… Ñ‚ÐµÐºÑÑ‚Ð°Ñ… Ð´ÐµÑ‚ÐµÐºÑ‚Ð¾Ñ€ ÑÐ¸Ð»ÑŒÐ½Ð¾ Ð²Ñ€Ñ‘Ñ‚, Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ 8 ÑÑ‚Ð¾ Ñ‚Ð¾Ð¶Ðµ Ð¼Ð°Ð»Ð¾
    if sum(1 for word in text.split() if len(word) >= 2) < 8:
        return None

    # ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ð¼ ÑÐ¿Ð¸ÑÐ¾Ðº Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹, Ð¸ ÐµÑÐ»Ð¸ Ð² ÑÐ¿Ð¸ÑÐºÐµ ÐµÑÑ‚ÑŒ Ñ€ÑƒÑÑÐºÐ¸Ð¹ Ñ‚Ð¾ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ None (Ñ Ñ€ÑƒÑÑÐºÐ¾Ð³Ð¾ Ð½Ð° Ñ€ÑƒÑÑÐºÐ¸Ð¹ Ð½Ðµ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ð¼)
    #print(detect_langs(text))
    try:
        for i in detect_langs(text):
            if i.lang == 'ru':
                return None
    except Exception as e:
        print(e)
        return None

    try:
        language = detect(text)
    except Exception as e:
        print(e)
        return None
    return language


def translate_text(text, lang = 'ru'):
    """ Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ None ÐµÑÐ»Ð¸ Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿ÐµÑ€ÐµÐ²ÐµÑÑ‚Ð¸ Ð¸ Ñ‚ÐµÐºÑÑ‚ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÐµÑÐ»Ð¸ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ """
    x = PyTranslator()
    r = x.translate(text, lang)
    if r['status'] == 'success':
        return r['translation']
    return None
    

def translate_text2(text, lang = 'ru'):
    """ ÐŸÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ñ‚ text Ð½Ð° ÑÐ·Ñ‹Ðº lang Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚Ñ‹ trans. Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ None ÐµÑÐ»Ð¸ Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿ÐµÑ€ÐµÐ²ÐµÑÑ‚Ð¸ Ð¸ Ñ‚ÐµÐºÑÑ‚ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÐµÑÐ»Ð¸ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ """
    process = subprocess.Popen(['trans', f':{lang}', '-b', text], stdout = subprocess.PIPE)
    output, error = process.communicate()
    r = output.decode('utf-8').strip()
    if error != None:
        return None
    return r


def translate(text):
    """ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð´Ð¾ Ð»Ð¸ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ñ‚ÑŒ Ð½Ð° Ñ€ÑƒÑÑÐºÐ¸Ð¹ Ð¸ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ð¼ ÐµÑÐ»Ð¸ Ð½Ð°Ð´Ð¾.
    Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ None ÐµÑÐ»Ð¸ Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿ÐµÑ€ÐµÐ²ÐµÑÑ‚Ð¸ Ð¸ Ñ‚ÐµÐºÑÑ‚ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° ÐµÑÐ»Ð¸ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ """
    if text:
        d = detect_lang(text)
    else:
        return None
    # Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ð¼ ÐµÑÐ»Ð¸ ÑÐ·Ñ‹Ðº Ð½Ðµ Ñ€ÑƒÑÑÐºÐ¸Ð¹ Ð½Ð¾ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ð»ÑÑ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾
    if d and d != 'ru':
        # ÑÑ‚Ð¾Ñ‚ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ñ‚Ð¾ Ð·Ð°Ð¼ÐµÑ‚Ð½Ð¾ Ñ…ÑƒÐ¶Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ñ…Ð¾Ñ‚Ñ Ð²Ñ€Ð¾Ð´Ðµ Ð±Ñ‹ Ñ‚Ð¾Ñ‚ Ð¶Ðµ ÑÐ°Ð¼Ñ‹Ð¹ Ð³ÑƒÐ³Ð» Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ñ‡Ð¸Ðº
        #return translate_text(text)

        #Ñƒ ÑÑ‚Ð¾Ð³Ð¾ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð° ÐµÑÑ‚ÑŒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ ÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²ÐºÐ°Ð¼Ð¸ Ð² Ð´Ð¾ÐºÐµÑ€Ðµ Ð–)
        #return translate_text2(text)
        
        #return gpt_basic.translate_text(text) or translate_text2(text) or None
        # Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ð¸Ð» Ð“ÐŸÐ¢, Ð¾Ð½ Ñ‡Ð°ÑÑ‚Ð¾ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ñ†ÐµÐ½Ð·ÑƒÑ€Ñƒ
        return translate_text2(text) or None
    return None
    

if __name__ == "__main__":
    #text="""Ð—Ð²Ð¸Ñ‡Ð°Ð¹Ð½Ð¾, Ñ Ð¼Ð¾Ð¶Ñƒ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚Ð¸ Ð´Ð²Ð° Ñ€ÐµÑ‡ÐµÐ½Ð½Ñ Ð½Ð° ÑƒÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÑ–Ð¹ Ð¼Ð¾Ð²Ñ–."""
    
    
    text = """ÐšÐ¾Ð»Ð¸ Ñƒ Ð½Ð°Ñ Ð±ÑƒÐ´ÑƒÑ‚ÑŒ F-16, Ð¼Ð¸ Ð²Ð¸Ð³Ñ€Ð°Ñ”Ð¼Ð¾ Ñ†ÑŽ Ð²Ñ–Ð¹Ð½Ñƒ, - Ð†Ð³Ð½Ð°Ñ‚

F-16 â€“ Ð±Ð°Ð³Ð°Ñ‚Ð¾Ñ†Ñ–Ð»ÑŒÐ¾Ð²Ð¸Ð¹ Ð»Ñ–Ñ‚Ð°Ðº, ÑÐºÐ¸Ð¹ Ð¼Ð¾Ð¶Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ð¾ Ð½Ð°Ð·ÐµÐ¼Ð½Ð¸Ñ…, Ð¿Ð¾Ð²Ñ–Ñ‚Ñ€ÑÐ½Ð¸Ñ… Ñ‚Ð° Ð½Ð°Ð´Ð²Ð¾Ð´Ð½Ð¸Ñ… Ñ†Ñ–Ð»ÑÑ…, Ð° Ñ‚Ð°ÐºÐ¾Ð¶ Ð±ÑƒÐ´Ðµ Ð¿ÐµÑ€ÐµÐºÑ€Ð¸Ð²Ð°Ñ‚Ð¸ Ð½Ð°ÑˆÑƒ Ñ‚ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–ÑŽ Ñ‚Ð°Ð¼, Ð´Ðµ Ð½ÐµÐ¼Ð°Ñ” ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑÑ–Ð² ÐŸÐŸÐž.

"Ð¯ Ð²Ð°Ð¼ ÑÐºÐ°Ð¶Ñƒ Ð±Ñ–Ð»ÑŒÑˆÐµ, ÐºÐ¾Ð»Ð¸ Ð±ÑƒÐ´ÑƒÑ‚ÑŒ F-16, Ð¼Ð¸ Ð²Ð¸Ð³Ñ€Ð°Ñ”Ð¼Ð¾ Ñ†ÑŽ Ð²Ñ–Ð¹Ð½Ñƒ. Ð¯ÐºÑ‰Ð¾ Ñ†Ñ– Ð»Ñ–Ñ‚Ð°ÐºÐ¸ Ð¿Ñ€Ð¸Ð¹Ð´ÑƒÑ‚ÑŒ Ð² Ð£ÐºÑ€Ð°Ñ—Ð½Ñƒ, Ð²Ð¾Ð½Ð¸ ÑÑ‚Ð°Ð½ÑƒÑ‚ÑŒ Ð½Ð° Ð±Ð¾Ð¹Ð¾Ð²Ðµ Ñ‡ÐµÑ€Ð³ÑƒÐ²Ð°Ð½Ð½Ñ Ñƒ Ñ€Ñ–Ð·Ð½Ð¸Ñ… Ñ€ÐµÐ³Ñ–Ð¾Ð½Ð°Ñ… Ð½Ð° Ð½Ð°ÑˆÐ¸Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¸Ð²Ð½Ð¸Ñ… Ð°ÐµÑ€Ð¾Ð´Ñ€Ð¾Ð¼Ð°Ñ…", â€” Ð·Ð°ÑƒÐ²Ð°Ð¶Ð¸Ð² Ð†Ð³Ð½Ð°Ñ‚.

Ð¢ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ ÐºÑ€Ð°Ñ—Ð½Ð¸ Ñ‚Ð° Ð¿Ñ€Ð¾Ñ‚ÑÐ¶Ð½Ñ–ÑÑ‚ÑŒ Ð´ÐµÑ€Ð¶Ð°Ð²Ð½Ð¾Ð³Ð¾ ÐºÐ¾Ñ€Ð´Ð¾Ð½Ñƒ Ð²ÐµÐ»Ð¸ÐºÐ°, Ð° Ð»Ñ–Ð½Ñ–Ñ Ñ„Ñ€Ð¾Ð½Ñ‚Ñƒ, Ð²Ñ€Ð°Ñ…Ð¾Ð²ÑƒÑŽÑ‡Ð¸ Ð‘Ñ–Ð»Ð¾Ñ€ÑƒÑÑŒ, ÐŸÑ€Ð¸Ð´Ð½Ñ–ÑÑ‚Ñ€Ð¾Ð²'Ñ Ñ‚Ð° Ñ‡Ð¾Ñ€Ð½Ð¾Ð¼Ð¾Ñ€ÑÑŒÐºÐµ ÑƒÐ·Ð±ÐµÑ€ÐµÐ¶Ð¶Ñ - Ð¿Ð¾Ð½Ð°Ð´ 2,5 Ñ‚Ð¸Ñ. ÐºÐ¼ Ñ– Ð¿ÐµÑ€ÐµÐºÑ€Ð¸Ñ‚Ð¸ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ°Ð¼Ð¸ ÐŸÐŸÐž, Ð²ÑÐµ Ð½Ðµ Ð²Ð´Ð°ÑÑ‚ÑŒÑÑ, ÑÐ°Ð¼Ðµ Ñ‚Ð¾Ð¼Ñƒ Ð½Ð°Ð¼ Ñ‚Ñ€ÐµÐ±Ð° F-16.

Ð¦ÐµÐ¹ Ð²Ð¸Ð½Ð¸Ñ‰ÑƒÐ²Ð°Ñ‡ Ð¼Ð¾Ð¶Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ð¾ Ð¿Ð¾Ð²Ñ–Ñ‚Ñ€ÑÐ½Ð¸Ñ… Ñ†Ñ–Ð»ÑÑ… ÑÐº Ð·Ð½Ð¸Ð·Ñƒ, Ñ‚Ð°Ðº Ñ– Ð·Ð²ÐµÑ€Ñ…Ñƒ. Ð¢Ð°Ð¼, Ð´Ðµ Ð½ÐµÐ¼Ð°Ñ” ÐŸÐŸÐž, Ð±ÑƒÐ´Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸ F-16.

Ð½Ð°Ð´iÑÐ»Ð°Ñ‚Ð¸ Ð½Ð¾Ð²Ð¸Ð½Ñƒ @novosti_kieva_bot
ðŸ‘‰ÐŸÐ†Ð”ÐŸÐ˜Ð¡ÐÐ¢Ð˜Ð¡Ð¬ (https://t.me/+YjYxxNba5fYyN2Ni)"""
    
    print(translate_text2(text, 'en'))
    
    #print(translate_text(text))
    #print(translate_text2(text))

    #print(translate(text))
